# -*- coding: utf-8 -*-
"""PROJECT Singapore_prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1uiDBuVvQ577OH_c0onPb2azBu14GDK0d
"""

import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt

# List of file names
file_names = [
    "Resale Flat Prices (Based on Approval Date), 1990 - 1999.csv",
    "Resale Flat Prices (Based on Approval Date), 2000 - Feb 2012.csv",
    "Resale Flat Prices (Based on Registration Date), From Mar 2012 to Dec 2014.csv",
    "Resale Flat Prices (Based on Registration Date), From Jan 2015 to Dec 2016.csv",
    "Resale flat prices based on registration date from Jan-2017 onwards.csv"
]

# Load and concatenate all dataframes
dfs = []
for file in file_names:
    df = pd.read_csv(file)
    dfs.append(df)


df_combined = pd.concat(dfs, ignore_index=True)

df_combined.to_csv("df_combined.csv")

# Display the head and info of the combined DataFrame
print("Combined DataFrame Head:")
print(df_combined.head())
print("\nCombined DataFrame Info:")
print(df_combined.info())

print(df_combined)
print("Combined DataFrame Head:")
print(df_combined.head())
print("Combined DataFrame Shape:")
print(df_combined.shape)
print("\nCombined DataFrame Columns:")
print(df_combined.columns)
print("\nCombined DataFrame Describe:")
print(df_combined.describe)
print("\nCombined DataFrame Info:")
print(df_combined.info())
print("\nCombined DataFrame DataType:")
print(df_combined.dtypes)
print("\nCombined DataFrame Isnull:")
# print(df_combined.isnull())
print(df_combined.isnull().sum())
# print(df_combined.isna())
print(df_combined.isna().sum())
# print(df_combined.duplicated())
print(df_combined.duplicated().sum())

df_combined.storey_range.unique()

df_combined.info()

df_combined.isnull().sum()

df_combined.nunique()

df_combined.drop('remaining_lease',axis=1,inplace=True)

df_combined.isna().sum()

df_combined.info()

cat_column = [col for col in df_combined.columns if df_combined[col].dtype == "object"]
num_column = [col for col in df_combined.columns if df_combined[col].dtype != "object"]

for col in cat_column:
    print(col,'-',len(df_combined[col].unique()))

for num in num_column:
    print(num,'-',len(df_combined[num].unique()))

df_combined.drop(['block','street_name'],axis=1,inplace=True)

df_combined.head()

df_combined['year'] = df_combined['month'].apply(lambda x: int(str(x)[:4]))
df_combined['month'] = df_combined['month'].apply(lambda x: int(str(x)[-2:]))

df_combined.head()

df_combined.year.unique()

df_combined.month.unique()

df_combined.isna().sum()



sns.scatterplot(data = df_combined, x = "floor_area_sqm", y = "resale_price")

plt.figure(figsize=(12,4))
a = df_combined.groupby('lease_commence_date')['resale_price'].sum()
a = pd.DataFrame(a)
sns.barplot(data=a,x=a.index,y='resale_price')
plt.xticks(rotation=90)
plt.show()

plt.figure(figsize=(12,4))
a = df_combined.groupby('year')['resale_price'].sum()
a = pd.DataFrame(a)
sns.barplot(data=a,x=a.index,y='resale_price')
plt.xticks(rotation=90)
plt.show()

plt.figure(figsize=(12,4))
a = df_combined.groupby('flat_type')['resale_price'].sum()
a = pd.DataFrame(a)
sns.barplot(data=a,x=a.index,y='resale_price')
plt.xticks(rotation=90)
plt.show()

df_combined.groupby('year').sum()['resale_price'].plot(kind='line')

df_combined.groupby('lease_commence_date')['resale_price'].sum().plot(kind='line')

scope_df = df_combined[['floor_area_sqm','lease_commence_date','resale_price']]
scope_df

scope_df = scope_df.drop_duplicates()
scope_df

col = ['floor_area_sqm','lease_commence_date','resale_price']

for i in col:
    plt.figure(figsize=(8, 6))
    sns.boxplot(data=df_combined, x=i)
    plt.title(f'Boxplot of {i}')
    plt.xlabel(i)
    plt.show()

from sklearn.preprocessing import OrdinalEncoder

ordinal_encoder = OrdinalEncoder()

object_columns = df_combined.select_dtypes(include=['object']).columns

df_combined[object_columns] = df_combined[object_columns].astype(str)

df_combined[object_columns] = ordinal_encoder.fit_transform(df_combined[object_columns])

plt.figure(figsize=(16,6))
sns.boxplot(data=df_combined)
plt.show()

df_combined.drop(['town','flat_type','flat_model'],axis=1,inplace=True)

X = df_combined.drop("resale_price",axis=1)
Y = df_combined['resale_price']

X.head()

from sklearn.model_selection import train_test_split
X_train,X_test,Y_train,Y_test = train_test_split(X,Y,test_size=0.3,random_state=42)

print(X_train.shape, X_test.shape)

X_train.dtypes

X_train.head()



from sklearn.linear_model import LinearRegression
model_LG = LinearRegression()
model_LG.fit(X_train,Y_train)

predection = model_LG.predict(X_test)

from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score

# r2_score(Y_test,predection)

pred = model_LG.predict(X_train)
# r2_score(Y_train,pred)

from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score

mae = mean_absolute_error(Y_test, predection)
mse = mean_squared_error(Y_test, predection)
rmse = np.sqrt(3)
r2 = r2_score(Y_test, predection)

print("\nModel Evaluation Metrics:")
print(f"Mean Absolute Error (MAE): ${mae:,.2f}")
print(f"Mean Squared Error (MSE): ${mse:,.2f}")
print(f"Root Mean Squared Error (RMSE): ${rmse:,.2f}")
print(f"R-squared (R2) Score: {r2:.4f}")

from sklearn.tree import DecisionTreeRegressor
model_DT = DecisionTreeRegressor()
model_DT.fit(X_train,Y_train)

Y_pred = model_DT.predict(X_test)

from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score

mae = mean_absolute_error(Y_test, Y_pred)
mse = mean_squared_error(Y_test, Y_pred)
rmse = np.sqrt(3)
r2 = r2_score(Y_test, Y_pred)

print("\nModel Evaluation Metrics:")
print(f"Mean Absolute Error (MAE): ${mae:,.2f}")
print(f"Mean Squared Error (MSE): ${mse:,.2f}")
print(f"Root Mean Squared Error (RMSE): ${rmse:,.2f}")
print(f"R-squared (R2) Score: {r2:.4f}")

from sklearn.preprocessing import OrdinalEncoder

ordinal_encoder = OrdinalEncoder()

object_columns = df_combined.select_dtypes(include=['object']).columns

df_combined[object_columns] = df_combined[object_columns].astype(str)

df_combined[object_columns] = ordinal_encoder.fit_transform(df_combined[object_columns])

# df_combined.drop(['town','flat_type','flat_model'],axis=1,inplace=True)

X = df_combined.drop("resale_price",axis=1)
Y = df_combined['resale_price']

from sklearn.model_selection import train_test_split
X_train, X_test, Y_train, Y_test = train_test_split(X,Y,test_size=0.33,random_state=42)

print(X_train.shape, X_test.shape)

X_train.dtypes

X_train.head()

from sklearn.ensemble import RandomForestRegressor
model_RF = RandomForestRegressor()
model_RF.fit(X_train,Y_train)

model_RF = RandomForestRegressor(
    n_estimators=50,
    max_depth=10,
    random_state=42,
    n_jobs=-1, # Use all available cores
    verbose=1
)

model_RF.fit(X_train, Y_train)

Y_pred = model_RF.predict(X_test)

# r2_score(Y_test,Y_pred)

from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score

mae = mean_absolute_error(Y_test, Y_pred)
mse = mean_squared_error(Y_test, Y_pred)
rmse = np.sqrt(3)
r2 = r2_score(Y_test, Y_pred)

print("\nModel Evaluation Metrics:")
print(f"Mean Absolute Error (MAE): ${mae:,.2f}")
print(f"Mean Squared Error (MSE): ${mse:,.2f}")
print(f"Root Mean Squared Error (RMSE): ${rmse:,.2f}")
print(f"R-squared (R2) Score: {r2:.4f}")

"""## pickle"""

import pickle
with open('DT_model.pkl', 'wb') as file:
      pickle.dump(model_DT,file)

"""### STREAMLIT"""

import pandas as pd
from ydata_profiling import ProfileReport

# Create a sample DataFrame
data = {'col1': [1, 2, 3, 4, 5],
        'col2': ['A', 'B', 'A', 'C', 'B'],
        'col3': [10.5, 12.1, None, 15.0, 11.8]}
df = pd.DataFrame(data)

# Generate the profile report
profile = ProfileReport(df, title="My Pandas DataFrame Profile")

# Display the report in a Jupyter Notebook or save it as an HTML file
# profile.to_widgets() # For displaying in Jupyter
profile.to_file("my_dataframe_profile.html") # To save as HTML

# !pip install ydata_profiling

